<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tool belastingen en toeslagen 2026</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React en ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone voor JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
  </style>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'claude-orange': '#CC785C',
            'claude-dark': '#2D2D2D',
            'claude-light': '#F5F5F5',
          }
        }
      }
    }
  </script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo } = React;
    
    // ============= CONSTANTEN =============
    const BELASTING_2026 = {
      BOX1_SCHIJVEN: [
        { grens: 38883, tarief: 0.3575 },
        { grens: 78426, tarief: 0.3756 },
        { grens: Infinity, tarief: 0.495 }
      ],
      BOX3: {
        HEFFINGSVRIJ_ENKEL: 59357,
        HEFFINGSVRIJ_PARTNER: 118714,
        SCHULD_DREMPEL_ENKEL: 3800,
        SCHULD_DREMPEL_PARTNER: 7600,
        RENDEMENT_BANK: 0.0128,
        RENDEMENT_BELEG: 0.06,
        RENDEMENT_SCHULD: 0.027,
        TARIEF: 0.36
      },
      EIGENWONINGFORFAIT: {
        GRENS_1: 75000,
        GRENS_2: 1350000,
        PERC_1: 0.0035,
        PERC_2: 0.0235,
        VAST_BEDRAG: 4725
      },
      HEFFINGSKORTINGEN: {
        AHK: {
          MAX: 3115,
          DREMPEL: 29736,
          AFBOUW_PERC: 0.06398
        },
        AK: {
          SCHIJVEN: [
            { tot: 11491, factor: 0.08425, vast: 0 },
            { tot: 25142, factor: 0.34503, vast: 968 },
            { tot: 45592, factor: 0, vast: 5685 },
            { tot: 132920, factor: -0.0651, vast: 5685, basis: 45592 }
          ]
        },
        IACK: {
          DREMPEL: 6239,
          FACTOR: 0.1145,
          MAX: 3032
        }
      },
      KINDGEBONDEN_BUDGET: {
        PER_KIND: 2580,
        DREMPEL_ENKEL: 29736,
        DREMPEL_PARTNER: 39141,
        AFBOUW_PERC: 0.076
      },
      KINDERBIJSLAG: {
        LEEFTIJD_0_5: { kwartaal: 295.07, perc: '70%' },
        LEEFTIJD_6_11: { kwartaal: 358.30, perc: '85%' },
        LEEFTIJD_12_17: { kwartaal: 421.53, perc: '100%' }
      },
      KINDEROPVANG: {
        MAX_UREN_MAAND: 230,
        TYPES: {
          dagopvang: 11.23,
          bso: 9.98,
          gastouder: 8.49
        }
      }
    };

    // Kinderopvang schijven (blijft groot, maar nu als constante)
    const KINDEROPVANG_SCHIJVEN = [
      { van: 0, tot: 24149, percEerste: 0.960, percVolgend: 0.960 },
      { van: 24150, tot: 25756, percEerste: 0.960, percVolgend: 0.960 },
      { van: 25757, tot: 27363, percEerste: 0.960, percVolgend: 0.960 },
      { van: 27364, tot: 28973, percEerste: 0.960, percVolgend: 0.960 },
      { van: 28974, tot: 30579, percEerste: 0.960, percVolgend: 0.960 },
      { van: 30580, tot: 32189, percEerste: 0.960, percVolgend: 0.960 },
      { van: 32190, tot: 33795, percEerste: 0.960, percVolgend: 0.960 },
      { van: 33796, tot: 35400, percEerste: 0.960, percVolgend: 0.960 },
      { van: 35401, tot: 37129, percEerste: 0.960, percVolgend: 0.960 },
      { van: 37130, tot: 38855, percEerste: 0.960, percVolgend: 0.960 },
      { van: 38856, tot: 40586, percEerste: 0.960, percVolgend: 0.960 },
      { van: 40587, tot: 42313, percEerste: 0.960, percVolgend: 0.960 },
      { van: 42314, tot: 44046, percEerste: 0.960, percVolgend: 0.960 },
      { van: 44047, tot: 45776, percEerste: 0.960, percVolgend: 0.960 },
      { van: 45777, tot: 47546, percEerste: 0.960, percVolgend: 0.960 },
      { van: 47547, tot: 49318, percEerste: 0.960, percVolgend: 0.960 },
      { van: 49319, tot: 51092, percEerste: 0.960, percVolgend: 0.960 },
      { van: 51093, tot: 52864, percEerste: 0.960, percVolgend: 0.960 },
      { van: 52865, tot: 54641, percEerste: 0.960, percVolgend: 0.960 },
      { van: 54642, tot: 56412, percEerste: 0.960, percVolgend: 0.960 },
      { van: 56413, tot: 58184, percEerste: 0.955, percVolgend: 0.956 },
      { van: 58185, tot: 59957, percEerste: 0.948, percVolgend: 0.956 },
      { van: 59958, tot: 61895, percEerste: 0.939, percVolgend: 0.956 },
      { van: 61896, tot: 65695, percEerste: 0.924, percVolgend: 0.956 },
      { van: 65696, tot: 69492, percEerste: 0.916, percVolgend: 0.952 },
      { van: 69493, tot: 73292, percEerste: 0.905, percVolgend: 0.946 },
      { van: 73293, tot: 77094, percEerste: 0.882, percVolgend: 0.942 },
      { van: 77095, tot: 80891, percEerste: 0.859, percVolgend: 0.939 },
      { van: 80892, tot: 84693, percEerste: 0.837, percVolgend: 0.932 },
      { van: 84694, tot: 88491, percEerste: 0.812, percVolgend: 0.927 },
      { van: 88492, tot: 92291, percEerste: 0.789, percVolgend: 0.922 },
      { van: 92292, tot: 96091, percEerste: 0.767, percVolgend: 0.915 },
      { van: 96092, tot: 99889, percEerste: 0.743, percVolgend: 0.909 },
      { van: 99890, tot: 103694, percEerste: 0.721, percVolgend: 0.905 },
      { van: 103695, tot: 107492, percEerste: 0.696, percVolgend: 0.902 },
      { van: 107493, tot: 111290, percEerste: 0.673, percVolgend: 0.895 },
      { van: 111291, tot: 115090, percEerste: 0.651, percVolgend: 0.891 },
      { van: 115091, tot: 118963, percEerste: 0.627, percVolgend: 0.886 },
      { van: 118964, tot: 122857, percEerste: 0.606, percVolgend: 0.879 },
      { van: 122858, tot: 126747, percEerste: 0.585, percVolgend: 0.874 },
      { van: 126748, tot: 130638, percEerste: 0.564, percVolgend: 0.870 },
      { van: 130639, tot: 134527, percEerste: 0.542, percVolgend: 0.867 },
      { van: 134528, tot: 138420, percEerste: 0.523, percVolgend: 0.860 },
      { van: 138421, tot: 142312, percEerste: 0.504, percVolgend: 0.854 },
      { van: 142313, tot: 146205, percEerste: 0.485, percVolgend: 0.850 },
      { van: 146206, tot: 150092, percEerste: 0.465, percVolgend: 0.844 },
      { van: 150093, tot: 153982, percEerste: 0.445, percVolgend: 0.840 },
      { van: 153983, tot: 157877, percEerste: 0.425, percVolgend: 0.833 },
      { van: 157878, tot: 161766, percEerste: 0.405, percVolgend: 0.827 },
      { van: 161767, tot: 165657, percEerste: 0.385, percVolgend: 0.817 },
      { van: 165658, tot: 169547, percEerste: 0.365, percVolgend: 0.814 },
      { van: 169548, tot: 173440, percEerste: 0.365, percVolgend: 0.806 },
      { van: 173441, tot: 177335, percEerste: 0.365, percVolgend: 0.797 },
      { van: 177336, tot: 181223, percEerste: 0.365, percVolgend: 0.791 },
      { van: 181224, tot: 185114, percEerste: 0.365, percVolgend: 0.782 },
      { van: 185115, tot: 189002, percEerste: 0.365, percVolgend: 0.777 },
      { van: 189003, tot: 192896, percEerste: 0.365, percVolgend: 0.769 },
      { van: 192897, tot: 196789, percEerste: 0.365, percVolgend: 0.762 },
      { van: 196790, tot: 200681, percEerste: 0.365, percVolgend: 0.755 },
      { van: 200682, tot: 204571, percEerste: 0.365, percVolgend: 0.745 },
      { van: 204572, tot: 208458, percEerste: 0.365, percVolgend: 0.740 },
      { van: 208459, tot: 212353, percEerste: 0.365, percVolgend: 0.733 },
      { van: 212354, tot: 216242, percEerste: 0.365, percVolgend: 0.725 },
      { van: 216243, tot: 220134, percEerste: 0.365, percVolgend: 0.718 },
      { van: 220135, tot: 224026, percEerste: 0.365, percVolgend: 0.712 },
      { van: 224027, tot: 227915, percEerste: 0.365, percVolgend: 0.704 },
      { van: 227916, tot: 231807, percEerste: 0.365, percVolgend: 0.696 },
      { van: 231808, tot: 235697, percEerste: 0.365, percVolgend: 0.691 },
      { van: 235698, tot: Infinity, percEerste: 0.365, percVolgend: 0.682 }
    ];

    // ============= ICONS =============
    const Calculator = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><line x1="12" y1="14" x2="12" y2="18"/><line x1="8" y1="14" x2="8" y2="18"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="12" y1="10" x2="12" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/></svg>);
    const Users = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
    const Home = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
    const Baby = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 12h.01"/><path d="M15 12h.01"/><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1"/></svg>);
    const Euro = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12a7.9 7.9 0 0 0 7.8 8 7.7 7.7 0 0 0 5.2-2"/></svg>);
    const TrendingUp = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>);
    const FileText = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>);
    const History = ({ className }) => (<svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);

    // ============= HULPFUNCTIES =============
    const formatEuro = (bedrag) => new Intl.NumberFormat('nl-NL', { 
      style: 'currency', 
      currency: 'EUR' 
    }).format(bedrag);

    const parseNumber = (value) => parseFloat(value) || 0;

    // ============= BEREKENINGSFUNCTIES =============
    const eigenwoningforfait = (woz) => {
      const w = parseNumber(woz);
      const { GRENS_1, GRENS_2, PERC_1, PERC_2, VAST_BEDRAG } = BELASTING_2026.EIGENWONINGFORFAIT;
      
      if (w <= GRENS_1) return 0;
      if (w <= GRENS_2) return w * PERC_1;
      return VAST_BEDRAG + (w - GRENS_2) * PERC_2;
    };

    const berekenBox1 = (brutoInkomen, eigenwoningRente, ao, woz) => {
      const inkomen = parseNumber(brutoInkomen);
      const rente = parseNumber(eigenwoningRente);
      const aoVerzekering = parseNumber(ao);
      const ewf = eigenwoningforfait(woz);
      const box1Inkomen = inkomen - rente - aoVerzekering + ewf;
      
      let belasting = 0;
      let resterendInkomen = box1Inkomen;
      
      for (let i = 0; i < BELASTING_2026.BOX1_SCHIJVEN.length; i++) {
        const { grens, tarief } = BELASTING_2026.BOX1_SCHIJVEN[i];
        const vorigeGrens = i === 0 ? 0 : BELASTING_2026.BOX1_SCHIJVEN[i - 1].grens;
        
        if (resterendInkomen <= vorigeGrens) break;
        
        const belastbaarInSchijf = Math.min(resterendInkomen, grens) - vorigeGrens;
        belasting += belastbaarInSchijf * tarief;
      }
      
      return { box1Inkomen, belasting };
    };

    const berekenBox3 = (bank1, beleg1, schuld1, bank2, beleg2, schuld2, fiscaalPartner) => {
      const bank = parseNumber(bank1) + parseNumber(bank2);
      const beleg = parseNumber(beleg1) + parseNumber(beleg2);
      const schuld = parseNumber(schuld1) + parseNumber(schuld2);
      
      const { BOX3 } = BELASTING_2026;
      const heffingsVrij = fiscaalPartner ? BOX3.HEFFINGSVRIJ_PARTNER : BOX3.HEFFINGSVRIJ_ENKEL;
      const schuldDrempel = fiscaalPartner ? BOX3.SCHULD_DREMPEL_PARTNER : BOX3.SCHULD_DREMPEL_ENKEL;
      
      const totaalBezittingen = bank + beleg;
      const aftrekbareSchulden = Math.max(0, schuld - schuldDrempel);
      const grondslagRendement = totaalBezittingen - aftrekbareSchulden;
      const belastbaarVermogen = Math.max(0, grondslagRendement - heffingsVrij);
      
      let belastbaarRendement = 0;
      
      if (belastbaarVermogen > 0 && grondslagRendement > 0) {
        const rendementBank = bank * BOX3.RENDEMENT_BANK;
        const rendementBeleg = beleg * BOX3.RENDEMENT_BELEG;
        const rendementSchuld = aftrekbareSchulden * BOX3.RENDEMENT_SCHULD;
        const nettoRendementGrondslag = rendementBank + rendementBeleg - rendementSchuld;
        const ratio = belastbaarVermogen / grondslagRendement;
        belastbaarRendement = nettoRendementGrondslag * ratio;
      }
      
      const box3Belasting = belastbaarRendement * BOX3.TARIEF;
      
      return { belastbaarVermogen, belastbaarRendement, box3Belasting, grondslagRendement };
    };

    const berekenHeffingskortingen = (verzamelinkomen, arbeidsinkomen) => {
      const { AHK, AK } = BELASTING_2026.HEFFINGSKORTINGEN;
      
      // Algemene heffingskorting
      let ahk = AHK.MAX;
      if (verzamelinkomen > AHK.DREMPEL) {
        const afbouw = (verzamelinkomen - AHK.DREMPEL) * AHK.AFBOUW_PERC;
        ahk = Math.max(0, ahk - afbouw);
      }
      
      // Arbeidskorting
      let ak = 0;
      if (arbeidsinkomen > 0) {
        for (const schijf of AK.SCHIJVEN) {
          if (arbeidsinkomen <= schijf.tot) {
            if (schijf.basis) {
              ak = Math.max(0, schijf.vast - (arbeidsinkomen - schijf.basis) * Math.abs(schijf.factor));
            } else {
              ak = schijf.vast + arbeidsinkomen * schijf.factor;
            }
            break;
          }
        }
      }
      
      return { ahk, ak };
    };

    const berekenIACK = (arbeidsinkomen) => {
      const ai = parseNumber(arbeidsinkomen);
      const { IACK } = BELASTING_2026.HEFFINGSKORTINGEN;
      
      if (ai <= IACK.DREMPEL) return 0;
      return Math.min(IACK.MAX, IACK.FACTOR * (ai - IACK.DREMPEL));
    };

    const berekenKindgebondenBudget = (toetsInkomen, aantal, fiscaalPartner) => {
      if (aantal === 0) return 0;
      
      const { KINDGEBONDEN_BUDGET } = BELASTING_2026;
      const maxBedrag = KINDGEBONDEN_BUDGET.PER_KIND * aantal;
      const drempel = fiscaalPartner ? KINDGEBONDEN_BUDGET.DREMPEL_PARTNER : KINDGEBONDEN_BUDGET.DREMPEL_ENKEL;
      
      if (toetsInkomen <= drempel) return maxBedrag;
      
      const vermindering = (toetsInkomen - drempel) * KINDGEBONDEN_BUDGET.AFBOUW_PERC;
      return Math.max(0, maxBedrag - vermindering);
    };

    const berekenKinderopvangtoeslag = (toetsInkomen, opvangDetails) => {
      if (!opvangDetails || opvangDetails.length === 0) return 0;
      
      // Vind juiste schijf
      const schijf = KINDEROPVANG_SCHIJVEN.find(s => 
        toetsInkomen >= s.van && toetsInkomen <= s.tot
      ) || KINDEROPVANG_SCHIJVEN[KINDEROPVANG_SCHIJVEN.length - 1];
      
      const { percEerste, percVolgend } = schijf;
      const { MAX_UREN_MAAND, TYPES } = BELASTING_2026.KINDEROPVANG;
      
      let totaal = 0;
      const gesorteerd = [...opvangDetails].sort((a, b) => (b.uren || 0) - (a.uren || 0));
      
      gesorteerd.forEach((opv, index) => {
        const urenMaand = Math.min(opv.uren || 0, MAX_UREN_MAAND);
        const urenJaar = urenMaand * 12;
        const maxPrijs = TYPES[opv.type] || 0;
        const perc = (index === 0) ? percEerste : percVolgend;
        totaal += urenJaar * maxPrijs * perc;
      });
      
      return Math.round(totaal);
    };

    const berekenKinderbijslag = (leeftijden) => {
      const { KINDERBIJSLAG } = BELASTING_2026;
      let totaalJaar = 0;
      const details = [];
      
      leeftijden.forEach((leeftijd, index) => {
        let config = null;
        
        if (leeftijd >= 0 && leeftijd <= 5) config = KINDERBIJSLAG.LEEFTIJD_0_5;
        else if (leeftijd >= 6 && leeftijd <= 11) config = KINDERBIJSLAG.LEEFTIJD_6_11;
        else if (leeftijd >= 12 && leeftijd <= 17) config = KINDERBIJSLAG.LEEFTIJD_12_17;
        
        if (config) {
          const jaarBedrag = config.kwartaal * 4;
          totaalJaar += jaarBedrag;
          details.push({
            kind: index + 1,
            leeftijd,
            percentage: config.perc,
            kwartaal: config.kwartaal,
            jaar: jaarBedrag
          });
        }
      });
      
      return { totaalJaar, details };
    };

    // ============= REUSABLE COMPONENTS =============
    const InputField = ({ label, value, onChange, placeholder, info }) => (
      <div>
        <label className="block text-sm font-semibold text-gray-700 mb-2">{label}</label>
        <input 
          type="number" 
          value={value} 
          onChange={(e) => onChange(e.target.value)} 
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
          placeholder={placeholder}
        />
        {info && <p className="text-xs text-gray-500 mt-1">{info}</p>}
      </div>
    );

    const PersoonBox1Inputs = ({ title, bgClass, data, onChange }) => (
      <div className={`space-y-4 ${bgClass} p-6 rounded-lg`}>
        <h3 className="font-bold text-lg text-gray-800">{title}</h3>
        <InputField 
          label="Brutoloon (€)" 
          value={data.brutoLoon} 
          onChange={(val) => onChange('brutoLoon', val)} 
          placeholder="50000"
        />
        <InputField 
          label="Betaalde hypotheekrente (€)" 
          value={data.eigenWoningRente} 
          onChange={(val) => onChange('eigenWoningRente', val)} 
          placeholder="8000"
        />
        <InputField 
          label="Arbeidsongeschiktheidsverzekering (€)" 
          value={data.arbeidsongeschiktheid} 
          onChange={(val) => onChange('arbeidsongeschiktheid', val)} 
          placeholder="2000"
        />
        <InputField 
          label="Ingehouden loonheffing (€)" 
          value={data.ingehoudenLoonheffing} 
          onChange={(val) => onChange('ingehoudenLoonheffing', val)} 
          placeholder="15000"
        />
      </div>
    );

    const PersoonBox3Inputs = ({ title, bgClass, data, onChange }) => (
      <div className={`space-y-4 ${bgClass} p-6 rounded-lg`}>
        <h3 className="font-bold text-lg text-gray-800">{title}</h3>
        <InputField 
          label="Bankrekeningen (€)" 
          value={data.bankrekeningen} 
          onChange={(val) => onChange('bankrekeningen', val)} 
          placeholder="30000"
          info="Rendement: 1,28%"
        />
        <InputField 
          label="Beleggingen (€)" 
          value={data.beleggingen} 
          onChange={(val) => onChange('beleggingen', val)} 
          placeholder="50000"
          info="Rendement: 6,00%"
        />
        <InputField 
          label="Schulden (€)" 
          value={data.schulden} 
          onChange={(val) => onChange('schulden', val)} 
          placeholder="10000"
          info="Rendement: 2,70% (na drempel €3.800)"
        />
      </div>
    );

    const HeffingskortinenDetailBox = ({ titel, kortingen, iack }) => (
      <div>
        <p className="text-sm font-semibold text-gray-700 mb-2">{titel}</p>
        <div className="space-y-2 bg-white p-3 rounded">
          <div className="flex justify-between text-sm">
            <span>Algemene heffingskorting:</span>
            <span className="font-semibold">{formatEuro(kortingen.ahk)}</span>
          </div>
          <div className="flex justify-between text-sm">
            <span>Arbeidskorting:</span>
            <span className="font-semibold">{formatEuro(kortingen.ak)}</span>
          </div>
          {iack > 0 && (
            <div className="flex justify-between text-sm">
              <span>IACK:</span>
              <span className="font-semibold">{formatEuro(iack)}</span>
            </div>
          )}
          <div className="flex justify-between text-sm pt-2 border-t border-gray-200 font-semibold">
            <span>Totaal:</span>
            <span>{formatEuro(kortingen.ahk + kortingen.ak + iack)}</span>
          </div>
        </div>
      </div>
    );

    const TabButton = ({ active, onClick, icon: Icon, label, badge }) => (
      <button 
        onClick={onClick} 
        className={`flex-1 px-6 py-4 font-semibold transition-colors ${
          active 
            ? 'bg-orange-50 text-[#CC785C] border-b-2 border-[#CC785C]' 
            : 'text-gray-600 hover:bg-gray-50'
        }`}
      >
        <Icon className="inline mr-2 w-5 h-5" />
        {label}
        {badge !== undefined && ` (${badge})`}
      </button>
    );

    // ============= MAIN COMPONENT =============
    function BelastingCalculator() {
      // State
      const [fiscaalPartner, setFiscaalPartner] = useState(false);
      const [aantalKinderen, setAantalKinderen] = useState(0);
      const [kinderenLeeftijden, setKinderenLeeftijden] = useState([]);
      const [kindOpvang, setKindOpvang] = useState([]);
      const [wozWaarde, setWozWaarde] = useState('');
      
      // Persoon 1 data
      const [persoon1, setPersoon1] = useState({
        brutoLoon: '',
        eigenWoningRente: '',
        arbeidsongeschiktheid: '',
        ingehoudenLoonheffing: '',
        bankrekeningen: '',
        beleggingen: '',
        schulden: ''
      });
      
      // Persoon 2 data
      const [persoon2, setPersoon2] = useState({
        brutoLoon: '',
        eigenWoningRente: '',
        arbeidsongeschiktheid: '',
        ingehoudenLoonheffing: '',
        bankrekeningen: '',
        beleggingen: '',
        schulden: ''
      });
      
      const [resultaten, setResultaten] = useState(null);
      const [activeTab, setActiveTab] = useState('stamgegevens');
      const [berekeningenLog, setBerekeningenLog] = useState([]);

      // Handlers
      const updatePersoon1 = (field, value) => {
        setPersoon1(prev => ({ ...prev, [field]: value }));
      };

      const updatePersoon2 = (field, value) => {
        setPersoon2(prev => ({ ...prev, [field]: value }));
      };

      const updateAantalKinderen = (aantal) => {
        setAantalKinderen(aantal);
        setKinderenLeeftijden(Array(aantal).fill(10));
        setKindOpvang(Array(aantal).fill({ uren: 0, type: 'dagopvang' }));
      };

      const updateKindLeeftijd = (index, leeftijd) => {
        const nieuwe = [...kinderenLeeftijden];
        nieuwe[index] = parseInt(leeftijd) || 0;
        setKinderenLeeftijden(nieuwe);
      };

      const updateKindOpvangUren = (index, uren) => {
        const nieuwe = [...kindOpvang];
        nieuwe[index] = { ...nieuwe[index], uren: parseInt(uren) || 0 };
        setKindOpvang(nieuwe);
      };

      const updateKindOpvangType = (index, type) => {
        const nieuwe = [...kindOpvang];
        nieuwe[index] = { ...nieuwe[index], type };
        setKindOpvang(nieuwe);
      };

      const berekenAlles = () => {
  const wozNum = parseNumber(wozWaarde);
  
  // Box 1 berekeningen
  const box1P1 = berekenBox1(persoon1.brutoLoon, persoon1.eigenWoningRente, persoon1.arbeidsongeschiktheid, wozNum);
  const box1P2 = fiscaalPartner 
    ? berekenBox1(persoon2.brutoLoon, persoon2.eigenWoningRente, persoon2.arbeidsongeschiktheid, 0) 
    : { box1Inkomen: 0, belasting: 0 };
  
  const totaalBox1Inkomen = box1P1.box1Inkomen + box1P2.box1Inkomen;
  const totaalBox1Belasting = box1P1.belasting + box1P2.belasting;
  
  // Box 3 berekeningen
  const box3 = berekenBox3(
    persoon1.bankrekeningen, persoon1.beleggingen, persoon1.schulden,
    persoon2.bankrekeningen, persoon2.beleggingen, persoon2.schulden,
    fiscaalPartner
  );
  
  // Verzamelinkomen = Box 1 inkomen + Box 3 belastbaar rendement
  const verzamelinkomen = totaalBox1Inkomen + box3.belastbaarRendement;
  
  // Heffingskortingen
  const kortingen1 = berekenHeffingskortingen(box1P1.box1Inkomen, parseNumber(persoon1.brutoLoon));
  const kortingen2 = fiscaalPartner 
    ? berekenHeffingskortingen(box1P2.box1Inkomen, parseNumber(persoon2.brutoLoon)) 
    : { ahk: 0, ak: 0 };
  
  // IACK
  const heeftKindOnder12 = kinderenLeeftijden.some(l => l < 12);
  let iackTotaal = 0;
  if (heeftKindOnder12 && aantalKinderen > 0) {
    const iack1 = berekenIACK(persoon1.brutoLoon);
    if (fiscaalPartner) {
      const iack2 = berekenIACK(persoon2.brutoLoon);
      iackTotaal = parseNumber(persoon1.brutoLoon) <= parseNumber(persoon2.brutoLoon) ? iack1 : iack2;
    } else {
      iackTotaal = iack1;
    }
  }
  
  const totaalHeffingskortingen = kortingen1.ahk + kortingen1.ak + kortingen2.ahk + kortingen2.ak + iackTotaal;
  const brutoBelasting = totaalBox1Belasting + box3.box3Belasting;
  const nettoBelasting = Math.max(0, brutoBelasting - totaalHeffingskortingen);
  const totaalIngehoudenLoonheffing = parseNumber(persoon1.ingehoudenLoonheffing) + parseNumber(persoon2.ingehoudenLoonheffing);
  const teBetalenOntvangen = totaalIngehoudenLoonheffing - nettoBelasting;
  
  // Toeslagen en bijslag - gebruik verzamelinkomen
  const kindgebondenBudget = berekenKindgebondenBudget(verzamelinkomen, aantalKinderen, fiscaalPartner);
  const kinderbijslag = berekenKinderbijslag(kinderenLeeftijden);
  const kinderopvangtoeslag = berekenKinderopvangtoeslag(verzamelinkomen, kindOpvang);
        
        const nieuweResultaten = {
          persoon1: {
            box1: box1P1, 
            kortingen: kortingen1, 
            iack: iackTotaal > 0 && parseNumber(persoon1.brutoLoon) <= parseNumber(persoon2.brutoLoon) ? iackTotaal : 0
          },
          persoon2: {
            box1: box1P2, 
            kortingen: kortingen2, 
            iack: iackTotaal > 0 && fiscaalPartner && parseNumber(persoon2.brutoLoon) < parseNumber(persoon1.brutoLoon) ? iackTotaal : 0
          },
          box3,
          totaal: {
            box1Inkomen: totaalBox1Inkomen,
            box1Belasting: totaalBox1Belasting,
            box3Belasting: box3.box3Belasting,
            brutoBelasting,
            heffingskortingen: totaalHeffingskortingen,
            nettoBelasting,
            ingehoudenLoonheffing: totaalIngehoudenLoonheffing,
            teBetalenOntvangen,
            kindgebondenBudget,
            kinderbijslag,
            kinderopvangtoeslag,
            verzamelinkomen: totaalBox1Inkomen,
            iackTotaal
          }
        };
        
        // Log toevoegen
        const totaalVermogen = parseNumber(persoon1.bankrekeningen) + parseNumber(persoon2.bankrekeningen) + 
                               parseNumber(persoon1.beleggingen) + parseNumber(persoon2.beleggingen);
        
        const logEntry = {
          timestamp: new Date().toLocaleString('nl-NL'),
          input: {
            fiscaalPartner,
            aantalKinderen,
            totaalBox1Inkomen,
            totaalVermogen,
            teBetalen: teBetalenOntvangen,
            kinderopvangtoeslag,
            kindgebondenBudget,
            kinderbijslag: kinderbijslag.totaalJaar
          },
          resultaten: nieuweResultaten
        };
        
        setBerekeningenLog(prev => [logEntry, ...prev].slice(0, 10));
        setResultaten(nieuweResultaten);
        setActiveTab('resultaten');
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
              {/* Header */}
              <div className="bg-gradient-to-r from-[#CC785C] to-[#B86B52] p-6 text-white">
                <div className="flex items-center gap-3 mb-2">
                  <Calculator className="w-8 h-8" />
                  <h1 className="text-3xl font-bold">Tool belastingen en toeslagen 2026</h1>
                </div>
                <p className="text-blue-100">Bereken je Nederlandse belastingen en toeslagen voor het jaar 2026</p>
              </div>

              {/* Tabs */}
              <div className="border-b border-gray-200">
                <div className="flex">
                  <TabButton active={activeTab === 'stamgegevens'} onClick={() => setActiveTab('stamgegevens')} icon={Users} label="Stamgegevens" />
                  <TabButton active={activeTab === 'box1'} onClick={() => setActiveTab('box1')} icon={Euro} label="Box 1" />
                  <TabButton active={activeTab === 'box3'} onClick={() => setActiveTab('box3')} icon={TrendingUp} label="Box 3" />
                  <TabButton active={activeTab === 'resultaten'} onClick={() => setActiveTab('resultaten')} icon={FileText} label="Resultaten" />
                  <TabButton active={activeTab === 'log'} onClick={() => setActiveTab('log')} icon={History} label="Log" badge={berekeningenLog.length} />
                </div>
              </div>

              {/* Content */}
              <div className="p-6">
                {/* STAMGEGEVENS TAB */}
                {activeTab === 'stamgegevens' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Stamgegevens</h2>
                    
                    <div className="bg-blue-50 border-l-4 border-[#CC785C] p-4 rounded">
                      <label className="flex items-center space-x-3 cursor-pointer">
                        <input 
                          type="checkbox" 
                          checked={fiscaalPartner} 
                          onChange={(e) => setFiscaalPartner(e.target.checked)} 
                          className="w-5 h-5 text-[#CC785C] rounded focus:ring-2 focus:ring-[#CC785C]" 
                        />
                        <span className="font-semibold text-gray-800">Fiscaal partner</span>
                      </label>
                    </div>
                    
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        <Baby className="inline w-4 h-4 mr-1" />Aantal kinderen
                      </label>
                      <input 
                        type="number" 
                        min="0" 
                        value={aantalKinderen} 
                        onChange={(e) => updateAantalKinderen(parseInt(e.target.value) || 0)} 
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                      />
                    </div>
                    
                    {aantalKinderen > 0 && (
                      <>
                        <div className="bg-purple-50 p-4 rounded-lg space-y-3">
                          <h3 className="font-semibold text-gray-800">Leeftijden kinderen (voor kinderbijslag)</h3>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {Array.from({ length: aantalKinderen }).map((_, index) => (
                              <div key={index}>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                  Leeftijd kind {index + 1} (0-17 jaar)
                                </label>
                                <input 
                                  type="number" 
                                  min="0" 
                                  max="17" 
                                  value={kinderenLeeftijden[index] || ''} 
                                  onChange={(e) => updateKindLeeftijd(index, e.target.value)} 
                                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                  placeholder="Bijv. 10" 
                                />
                              </div>
                            ))}
                          </div>
                        </div>
                        
                        <div className="bg-teal-50 p-4 rounded-lg space-y-3">
                          <h3 className="font-semibold text-gray-800">Kinderopvang (uren per maand en type)</h3>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {Array.from({ length: aantalKinderen }).map((_, index) => (
                              <div key={index} className="space-y-2">
                                <label className="block text-sm font-medium text-gray-700">
                                  Kind {index + 1} - Uren per maand (max 230)
                                </label>
                                <input 
                                  type="number" 
                                  min="0" 
                                  max="230" 
                                  value={kindOpvang[index]?.uren || ''} 
                                  onChange={(e) => updateKindOpvangUren(index, e.target.value)} 
                                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                  placeholder="Bijv. 40" 
                                />
                                <label className="block text-sm font-medium text-gray-700">Type opvang</label>
                                <select 
                                  value={kindOpvang[index]?.type || 'dagopvang'} 
                                  onChange={(e) => updateKindOpvangType(index, e.target.value)} 
                                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                >
                                  <option value="dagopvang">Dagopvang</option>
                                  <option value="bso">BSO</option>
                                  <option value="gastouder">Gastouder</option>
                                </select>
                              </div>
                            ))}
                          </div>
                        </div>
                      </>
                    )}
                    
                    <div className="bg-gray-50 p-4 rounded-lg space-y-4">
                      <h3 className="font-semibold text-gray-800 flex items-center">
                        <Home className="w-5 h-5 mr-2" />WOZ-waarde eigen woning
                      </h3>
                      <InputField 
                        label="WOZ-waarde (€)" 
                        value={wozWaarde} 
                        onChange={setWozWaarde} 
                        placeholder="Bijv. 350000"
                      />
                    </div>
                  </div>
                )}

                {/* BOX 1 TAB */}
                {activeTab === 'box1' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Box 1: Inkomsten uit werk en woning</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <PersoonBox1Inputs 
                        title="Persoon 1" 
                        bgClass="bg-blue-50" 
                        data={persoon1} 
                        onChange={updatePersoon1}
                      />
                      {fiscaalPartner && (
                        <PersoonBox1Inputs 
                          title="Persoon 2 (Partner)" 
                          bgClass="bg-indigo-50" 
                          data={persoon2} 
                          onChange={updatePersoon2}
                        />
                      )}
                    </div>
                  </div>
                )}

                {/* BOX 3 TAB */}
                {activeTab === 'box3' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Box 3: Sparen en beleggen</h2>
                    <p className="text-sm text-gray-600 mb-4">Peildatum: 1 januari 2026</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <PersoonBox3Inputs 
                        title="Persoon 1" 
                        bgClass="bg-blue-50" 
                        data={persoon1} 
                        onChange={updatePersoon1}
                      />
                      {fiscaalPartner && (
                        <PersoonBox3Inputs 
                          title="Persoon 2 (Partner)" 
                          bgClass="bg-indigo-50" 
                          data={persoon2} 
                          onChange={updatePersoon2}
                        />
                      )}
                    </div>
                    <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                      <p className="text-sm text-gray-700">
                        <strong>Let op:</strong> Heffingsvrij vermogen is €59.357 per persoon (gezamenlijk €118.714 bij fiscaal partner). Schuldendrempel €3.800 per persoon (€7.600 bij partner).
                      </p>
                    </div>
                  </div>
                )}

                {/* RESULTATEN TAB */}
                {activeTab === 'resultaten' && resultaten && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Berekening resultaten 2026</h2>
                    
                    {/* Box 1 Resultaten */}
                    <div className="bg-blue-50 p-6 rounded-lg">
  <h3 className="text-xl font-bold text-gray-800 mb-4">Verzamelinkomen (Box 1 + Box 3 voordeel)</h3>
  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <p className="text-sm text-gray-600">Persoon 1 - Box 1 inkomen:</p>
      <p className="text-lg font-semibold">{formatEuro(resultaten.persoon1.box1.box1Inkomen)}</p>
      <p className="text-sm text-gray-600 mt-2">Persoon 1 - Box 1 belasting:</p>
      <p className="text-lg font-semibold">{formatEuro(resultaten.persoon1.box1.belasting)}</p>
    </div>
    {fiscaalPartner && (
      <div>
        <p className="text-sm text-gray-600">Persoon 2 - Box 1 inkomen:</p>
        <p className="text-lg font-semibold">{formatEuro(resultaten.persoon2.box1.box1Inkomen)}</p>
        <p className="text-sm text-gray-600 mt-2">Persoon 2 - Box 1 belasting:</p>
        <p className="text-lg font-semibold">{formatEuro(resultaten.persoon2.box1.belasting)}</p>
      </div>
    )}
  </div>
  <div className="mt-4 pt-4 border-t border-blue-200">
    <p className="text-sm text-gray-600">Totaal Box 1 inkomen:</p>
    <p className="text-lg font-semibold">{formatEuro(resultaten.totaal.box1Inkomen)}</p>
    <p className="text-sm text-gray-600 mt-2">Box 3 voordeel (belastbaar rendement):</p>
    <p className="text-lg font-semibold">+ {formatEuro(resultaten.box3.belastbaarRendement)}</p>
    <p className="text-sm text-gray-600 mt-3 font-semibold">Verzamelinkomen (voor toeslagen):</p>
    <p className="text-2xl font-bold text-blue-700">{formatEuro(resultaten.totaal.verzamelinkomen)}</p>
  </div>
  <div className="mt-4 pt-4 border-t border-blue-200">
    <p className="text-sm text-gray-600">Totaal Box 1 belasting:</p>
    <p className="text-lg font-semibold">{formatEuro(resultaten.totaal.box1Belasting)}</p>
  </div>
  <div className="mt-4">
    <p className="text-sm text-gray-600">Heffingskortingen:</p>
    <p className="text-lg font-semibold">{formatEuro(resultaten.totaal.heffingskortingen)}</p>
  </div>
  <div className="mt-4">
    <p className="text-sm text-gray-600">Ingehouden loonheffing:</p>
    <p className="text-lg font-semibold">{formatEuro(resultaten.totaal.ingehoudenLoonheffing)}</p>
  </div>
</div>
                    
                    {/* Box 3 Resultaten */}
                    <div className="bg-green-50 p-6 rounded-lg">
                      <h3 className="text-xl font-bold text-gray-800 mb-4">Box 3: Sparen en beleggen</h3>
                      <p className="text-sm text-gray-600">Belastbaar vermogen:</p>
                      <p className="text-lg font-semibold">{formatEuro(resultaten.box3.belastbaarVermogen)}</p>
                      <p className="text-sm text-gray-600 mt-2">Box 3 belasting:</p>
                      <p className="text-lg font-semibold">{formatEuro(resultaten.box3.box3Belasting)}</p>
                    </div>
                    
                    {/* Heffingskortingen Detail */}
                    <div className="bg-purple-50 p-6 rounded-lg">
                      <h3 className="text-xl font-bold text-gray-800 mb-4">Heffingskortingen</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <HeffingskortinenDetailBox 
                          titel="Persoon 1" 
                          kortingen={resultaten.persoon1.kortingen} 
                          iack={resultaten.persoon1.iack}
                        />
                        {fiscaalPartner && (
                          <HeffingskortinenDetailBox 
                            titel="Persoon 2 (Partner)" 
                            kortingen={resultaten.persoon2.kortingen} 
                            iack={resultaten.persoon2.iack}
                          />
                        )}
                      </div>
                      <div className="mt-4 pt-4 border-t border-purple-200">
                        <p className="text-sm text-gray-600">Totaal heffingskortingen:</p>
                        <p className="text-2xl font-bold text-purple-700">{formatEuro(resultaten.totaal.heffingskortingen)}</p>
                        {aantalKinderen > 0 && resultaten.totaal.iackTotaal > 0 && (
                          <p className="text-sm text-gray-500 mt-2">
                            IACK is toegekend aan {fiscaalPartner ? 'de minstverdienende partner' : 'persoon 1'}
                          </p>
                        )}
                      </div>
                    </div>
                    
                    {/* Toeslagen en bijslag */}
                    {aantalKinderen > 0 && (
                      <>
                        <div className="bg-pink-50 p-6 rounded-lg">
                          <h3 className="text-xl font-bold text-gray-800 mb-4">
                            <Baby className="inline w-6 h-6 mr-2" />Kindgebonden budget
                          </h3>
                          <p className="text-sm text-gray-600">
                            Jaarlijks kindgebonden budget ({aantalKinderen} {aantalKinderen === 1 ? 'kind' : 'kinderen'}):
                          </p>
                          <p className="text-2xl font-bold text-pink-700">{formatEuro(resultaten.totaal.kindgebondenBudget)}</p>
                          <p className="text-xs text-gray-500 mt-2">Dit bedrag ontvangt u maandelijks via de Belastingdienst Toeslagen</p>
                        </div>
                        
                        <div className="bg-indigo-50 p-6 rounded-lg">
                          <h3 className="text-xl font-bold text-gray-800 mb-4">
                            <Baby className="inline w-6 h-6 mr-2" />Kinderbijslag
                          </h3>
                          <p className="text-sm text-gray-600 mb-3">Kinderbijslag per kind (uitbetaald per kwartaal door SVB):</p>
                          <div className="space-y-2 mb-4">
                            {resultaten.totaal.kinderbijslag.details.map((detail) => (
                              <div key={detail.kind} className="flex justify-between text-sm bg-white p-2 rounded">
                                <span>Kind {detail.kind} ({detail.leeftijd} jaar, {detail.percentage}):</span>
                                <span className="font-semibold">{formatEuro(detail.kwartaal)} /kwartaal</span>
                              </div>
                            ))}
                          </div>
                          <div className="pt-3 border-t border-indigo-200">
                            <p className="text-sm text-gray-600">Totaal kinderbijslag per jaar:</p>
                            <p className="text-2xl font-bold text-indigo-700">{formatEuro(resultaten.totaal.kinderbijslag.totaalJaar)}</p>
                          </div>
                        </div>
                        
                        <div className="bg-teal-50 p-6 rounded-lg">
                          <h3 className="text-xl font-bold text-gray-800 mb-4">
                            <Baby className="inline w-6 h-6 mr-2" />Kinderopvangtoeslag
                          </h3>
                          <p className="text-sm text-gray-600">Jaarlijkse kinderopvangtoeslag:</p>
                          <p className="text-2xl font-bold text-teal-700">{formatEuro(resultaten.totaal.kinderopvangtoeslag)}</p>
                          <p className="text-xs text-gray-500 mt-2">Gebaseerd op ingevoerde uren en type opvang</p>
                        </div>
                      </>
                    )}
                    
                    {/* Eindresultaat */}
                    <div className="bg-gradient-to-r from-[#CC785C] to-[#B86B52] p-6 rounded-lg text-white">
                      <h3 className="text-2xl font-bold mb-6">Eindresultaat aangifte 2026</h3>
                      <div className="space-y-3">
                        <div className="flex justify-between items-center">
                          <span>Bruto belasting (Box 1 + Box 3):</span>
                          <span className="text-xl font-bold">{formatEuro(resultaten.totaal.brutoBelasting)}</span>
                        </div>
                        <div className="flex justify-between items-center">
                          <span>Totaal heffingskortingen:</span>
                          <span className="text-xl font-bold">- {formatEuro(resultaten.totaal.heffingskortingen)}</span>
                        </div>
                        <div className="border-t border-blue-400 pt-3 flex justify-between items-center">
                          <span className="font-semibold">Netto te betalen belasting:</span>
                          <span className="text-xl font-bold">{formatEuro(resultaten.totaal.nettoBelasting)}</span>
                        </div>
                        <div className="flex justify-between items-center">
                          <span>Ingehouden loonheffing:</span>
                          <span className="text-xl font-bold">{formatEuro(resultaten.totaal.ingehoudenLoonheffing)}</span>
                        </div>
                        <div className="border-t-2 border-white pt-4 mt-4">
                          <div className="flex justify-between items-center">
                            <span className="text-xl font-bold">
                              {resultaten.totaal.teBetalenOntvangen >= 0 ? 'Te ontvangen:' : 'Te betalen:'}
                            </span>
                            <span className="text-xl font-bold">
                              €{Math.abs(resultaten.totaal.teBetalenOntvangen).toLocaleString('nl-NL', {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                              })}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* LOG TAB */}
                {activeTab === 'log' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Geschiedenis</h2>
                    {berekeningenLog.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">
                        <History className="w-16 h-16 mx-auto mb-4 opacity-50" />
                        <p>Nog geen berekeningen uitgevoerd</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {berekeningenLog.map((log, index) => {
                          let marginaleVerandering = null;
                          let marginaleDruk = null;
                          let inkomenVerschil = null;
                          
                          if (index < berekeningenLog.length - 1) {
                            const vorigeLog = berekeningenLog[index + 1];
                            const huidigNetto = log.input.teBetalen + log.input.kinderopvangtoeslag + 
                                               log.input.kindgebondenBudget + log.input.kinderbijslag;
                            const vorigNetto = vorigeLog.input.teBetalen + vorigeLog.input.kinderopvangtoeslag + 
                                              vorigeLog.input.kindgebondenBudget + vorigeLog.input.kinderbijslag;
                            
                            marginaleVerandering = huidigNetto - vorigNetto;
                            inkomenVerschil = log.input.totaalBox1Inkomen - vorigeLog.input.totaalBox1Inkomen;
                            
                            if (inkomenVerschil !== 0) {
                              marginaleDruk = ((inkomenVerschil - marginaleVerandering) / inkomenVerschil) * 100;
                            }
                          }
                          
                          return (
                            <div key={index} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                              <div className="flex justify-between items-start mb-3">
                                <span className="text-sm font-semibold text-gray-700">{log.timestamp}</span>
                                {marginaleVerandering !== null ? (
                                  <div className="text-right">
                                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                      marginaleVerandering >= 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }`}>
                                      {marginaleVerandering >= 0 ? '+' : ''}{formatEuro(marginaleVerandering)} vs. vorige
                                    </span>
                                    {marginaleDruk !== null && inkomenVerschil !== 0 && (
                                      <p className="text-xs text-gray-600 mt-1">
                                        Marginale druk: {marginaleDruk.toFixed(1)}%
                                        {inkomenVerschil !== 0 && (
                                          <span className="text-gray-500"> (inkomen {inkomenVerschil >= 0 ? '+' : ''}{formatEuro(inkomenVerschil)})</span>
                                        )}
                                      </p>
                                    )}
                                  </div>
                                ) : (
                                  <span className="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                                    Eerste berekening
                                  </span>
                                )}
                              </div>
                             <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 text-sm">
  <div><span className="text-gray-600">Verzamelinkomen:</span><p className="font-semibold">{formatEuro(log.input.verzamelinkomen)}</p></div>
  <div><span className="text-gray-600">Vermogen:</span><p className="font-semibold">{formatEuro(log.input.totaalVermogen)}</p></div>
  <div><span className="text-gray-600">Belasting:</span><p className="font-semibold">{formatEuro(Math.abs(log.input.teBetalen))}</p></div>
  <div><span className="text-gray-600">KOT:</span><p className="font-semibold">{formatEuro(log.input.kinderopvangtoeslag)}</p></div>
  <div><span className="text-gray-600">KGB:</span><p className="font-semibold">{formatEuro(log.input.kindgebondenBudget)}</p></div>
  <div><span className="text-gray-600">Kinderbijslag:</span><p className="font-semibold">{formatEuro(log.input.kinderbijslag)}</p></div>
  <div><span className="text-gray-600">Totaal:</span><p className="font-semibold text-blue-700">{formatEuro(Math.abs(log.input.teBetalen + log.input.kinderopvangtoeslag + log.input.kindgebondenBudget + log.input.kinderbijslag))}</p></div>
</div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                )}
              </div>

              {/* Footer Button */}
              <div className="bg-gray-50 p-6 border-t border-gray-200">
                <button 
                  onClick={berekenAlles} 
                  className="w-full bg-gradient-to-r from-[#CC785C] to-[#B86B52] text-white py-4 px-6 rounded-lg font-bold text-lg hover:from-[#B86B52] hover:to-[#A85B42] transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
                >
                  <Calculator className="inline w-6 h-6 mr-2" />
                  Bereken belastingen en toeslagen
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<BelastingCalculator />, document.getElementById('root'));
  </script>
</body>
</html>
